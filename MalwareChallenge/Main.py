import ASMEnumerator as asme
import ASMKeyword as asmk
import numpy as np
import random
from sklearn import neighbors
from sklearn.metrics import accuracy_score, log_loss
from sklearn.multiclass import OneVsRestClassifier

root, ext = "~/Documents/DATA/asmdump/", ".asm"

enum = asme.ASMEnumerator("~/Downloads/trainLabels.csv", root, ext)
train_full = [(asmk.ASMKeyword(root+x+ext).normal_dict(), enum.asm_class[x]) for x in enum.next_files(250)]
train_full = [x for x in train_full if x[0] is not None]

train_data = [x[0] for x in train_full]
train_label = [x[1] for x in train_full]

test_full = [(asmk.ASMKeyword(root+x+ext).normal_dict(), enum.asm_class[x]) for x in enum.next_files(250)]
test_full = [x for x in test_full if x[0] is not None]

test_data = [x[0] for x in test_full]
test_label = [x[1] for x in test_full]

magic = neighbors.KNeighborsClassifier(weights="distance")
magic.fit(train_data, train_label)
print accuracy_score(test_label, magic.predict(test_data))
print log_loss(test_label, magic.predict_proba(test_data))
