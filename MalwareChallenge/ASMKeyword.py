import math
import matplotlib.pyplot as plt
import numpy as np
from os.path import expanduser

class ASMKeyword():
    def __init__(self, path):
        self.dict = {}
        for key in ["aaa", "aad", "aam", "aas", "adc", "add", "and", "call", "cbw", "clc", "cld", "cli", "cmc", "cmp", "cmpsb", "cmpsw", "cwd", "daa", "das", "dec", "div", "esc", "hlt", "idiv", "imul", "in", "inc", "int", "into", "iret", "jcc", "jcxz", "jmp", "lahf", "lds", "lea", "les", "lock", "lodsb", "lodsw", "loop", "mov", "movsb", "movsw", "mul", "neg", "nop", "not", "or", "out", "pop", "popf", "push", "pushf", "rcl", "rcr", "repxx", "ret", "retn", "retf", "rol", "ror", "sahf", "sal", "sar", "sbb", "scasb", "scasw", "shl", "shr", "stc", "std", "sti", "stosb", "stosw", "sub", "test", "wait", "xchg", "xlat", "xor"]:
            self.dict[key] = 0
        self.file = [row for row in open(expanduser(path + ".asm"), "r")]
        self.__keyword_dict()
        print len(self.file)
    def __keyword_dict(self):
        i = 1
        while i * 1000 < len(self.file):
            for key in str(self.file[(i - 1) * 1000:i * 1000]).split():
                if key in self.dict:
                    self.dict[key] += 1
            i += 1
    def normal_dict(self):
        norm = np.linalg.norm(self.dict.values())
        if math.isnan(norm) or norm == 0:
            return None
        else:
            return self.dict.values() / np.linalg.norm(self.dict.values())
    def show_keywords(self):
        plt.plot(self.normal_dict())
        plt.show()
    def _sum(self,ar):
        l = ''
        for a in ar:
            l+=a
        return l